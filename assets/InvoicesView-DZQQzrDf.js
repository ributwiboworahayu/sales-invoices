import{_ as j,u as z,r as i,b as D,d as L,o as a,c as l,a as e,F as w,e as x,t as o,f as P,w as A,n as _,g as $,h as N,i as S,j as C,p as M,k as V,l as U,m as F,q,R as E}from"./index-DRR1042j.js";const p=c=>(M("data-v-dab035e0"),c=c(),V(),c),W={key:0,class:"d-flex justify-content-center align-items-center",style:{height:"100vh"}},G=p(()=>e("div",{class:"spinner-border text-primary",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1)),H=[G],J={key:1},K={class:"table-responsive my-2"},Q={id:"invoices-table",class:"table table-bordered"},X={key:0},Y=p(()=>e("td",{colspan:"9",class:"text-center align-middle"},[e("div",{class:"spinner-border text-primary",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")])],-1)),Z=[Y],ee={key:1},te=["colspan"],se={key:0,class:"badge bg-success"},ae={key:1,class:"badge bg-secondary"},le={key:2,class:"badge bg-danger"},oe={class:"row"},ne={class:"col-3"},re=p(()=>e("i",{class:"bi bi-eye"},null,-1)),de={class:"col-2"},ie={class:"dropdown"},ce=p(()=>e("button",{class:"btn btn-outline-secondary btn-sm dropdown-toggle",type:"button",id:"dropdownMenuButton1","data-bs-toggle":"dropdown","aria-expanded":"false"},[e("i",{class:"bi bi-file-earmark-text"})],-1)),ue={class:"dropdown-menu","aria-labelledby":"dropdownMenuButton1"},_e=["onClick"],pe=["onClick"],he=p(()=>e("li",null,[e("hr",{class:"dropdown-divider"})],-1)),be=["onClick"],me={class:"d-flex justify-content-end"},ge={"aria-label":"Page navigation"},ve={class:"pagination"},ye=["onClick"],fe=10,ke={__name:"InvoicesTable",setup(c){const b=z(),m=i([{title:"Status",data:"status"},{title:"Sales Order Number",data:"salesOrderNumber"},{title:"SO Date",data:"soDate"},{title:"Customer Name",data:"customerName"},{title:"Sales Person",data:"salesPerson"},{title:"Terms",data:"terms"},{title:"Net Total",data:"netTotal"},{title:"Remarks",data:"remarks"},{title:"Actions",data:"actions"}]),g=i([]),v=i({}),T=i(!0),y=i(!1),r=i(1),u=i(0),h=async(n=1)=>{try{y.value=!0;const s=await N.get(`${S}invoices?page=${n}&limit=${fe}`,{headers:{Authorization:`Bearer ${C.get("token")}`}});if(s.data.status==="success"){g.value=s.data.data.records.map(t=>({status:t.status,salesOrderNumber:t.sales_order_number,soDate:t.so_date,customerName:t.customer_name,salesPerson:t.sales_person,terms:t.terms,netTotal:t.net_total,remarks:t.remarks??"",actions:[{text:"View",href:"/invoices/"+t.sales_order_number.replace(/\//g,"_")}]}));const d=s.data.data._metadata;v.value={currentPage:d.page,limit:d.per_page,totalRecords:d.total},u.value=Math.ceil(v.value.totalRecords/v.value.limit)}else alert(s.data.message)}catch(s){console.log(s),alert("Something went wrong: "+s)}finally{y.value=!1}},f=n=>{n>0&&n<=u.value&&(r.value=n,h(n))},O=()=>{r.value<u.value&&f(r.value+1)},R=()=>{r.value>1&&f(r.value-1)},I=async(n,s)=>{await N.put(`${S}invoices/${n.replace(/\//g,"_")}`,{status:s},{headers:{Authorization:`Bearer ${C.get("token")}`}}).catch(d=>{console.log(d),d.response.status===401?(alert("Unauthorized. Please login again"),b.push("/login")):alert("Something went wrong: "+d)}).finally(()=>{h(r.value)})},B=async n=>{confirm("Are you sure you want to delete this invoice?")&&await N.delete(`${S}invoices/${n.replace(/\//g,"_")}`,{headers:{Authorization:`Bearer ${C.get("token")}`}}).catch(s=>{console.log(s),s.response.status===401?(alert("Unauthorized. Please login again"),b.push("/login")):alert("Something went wrong: "+s)}).finally(()=>{h(r.value)})};return D(()=>{h(),setTimeout(()=>{T.value=!1},500)}),(n,s)=>{const d=L("RouterLink");return T.value?(a(),l("div",W,H)):(a(),l("div",J,[e("div",K,[e("table",Q,[e("thead",null,[e("tr",null,[(a(!0),l(w,null,x(m.value,t=>(a(),l("th",{key:t.title,scope:"col"},o(t.title),1))),128))])]),e("tbody",null,[y.value?(a(),l("tr",X,Z)):g.value.length===0?(a(),l("tr",ee,[e("td",{colspan:m.value.length,class:"text-center"},"No records found",8,te)])):(a(!0),l(w,{key:2},x(g.value,t=>(a(),l("tr",{key:t.salesOrderNumber},[e("td",null,[t.status==="Approved"?(a(),l("span",se,o(t.status),1)):t.status==="Wait"?(a(),l("span",ae,o(t.status),1)):(a(),l("span",le,o(t.status),1))]),e("td",null,o(t.salesOrderNumber),1),e("td",null,o(t.soDate),1),e("td",null,o(t.customerName),1),e("td",null,o(t.salesPerson),1),e("td",null,o(t.terms),1),e("td",null,o(t.netTotal),1),e("td",null,o(t.remarks),1),e("td",null,[e("div",oe,[e("div",ne,[P(d,{class:"btn btn-outline-secondary btn-sm view-btn",to:t.actions[0].href},{default:A(()=>[re]),_:2},1032,["to"])]),e("div",de,[e("div",ie,[ce,e("ul",ue,[e("li",null,[e("a",{class:_(["dropdown-item",{disabled:t.status==="Approved"}]),onClick:k=>I(t.salesOrderNumber,2)},"Approve",10,_e)]),e("li",null,[e("a",{class:_(["dropdown-item",{disabled:t.status==="Rejected"}]),onClick:k=>I(t.salesOrderNumber,3)},"Reject",10,pe)]),he,e("li",null,[e("button",{class:"dropdown-item text-bg-danger",onClick:k=>B(t.salesOrderNumber)},"Delete ",8,be)])])])])])])]))),128))])])]),e("div",me,[e("nav",ge,[e("ul",ve,[e("li",{class:_(["page-item",{disabled:r.value===1}])},[e("a",{class:"page-link",href:"#",onClick:$(R,["prevent"]),tabindex:"-1","aria-disabled":"true"},"Previous")],2),(a(!0),l(w,null,x(u.value,t=>(a(),l("li",{key:t,class:_(["page-item",{active:r.value===t}])},[e("a",{class:"page-link",href:"#",onClick:$(k=>f(t),["prevent"])},o(t),9,ye)],2))),128)),e("li",{class:_(["page-item",{disabled:r.value===u.value}])},[e("a",{class:"page-link",href:"#",onClick:$(O,["prevent"])},"Next")],2)])])])]))}}},we=j(ke,[["__scopeId","data-v-dab035e0"]]),xe={class:"container mt-4"},$e={class:"d-flex justify-content-between align-items-center mb-4"},Ne=e("h1",{class:"h1 mb-0"},"Sales Invoices",-1),Se=e("i",{class:"bi bi-plus"},null,-1),Ce=F('<div class="col-6"><div class="input-group mb-3"><input type="text" class="form-control" placeholder="Search" aria-label="Search" aria-describedby="button-addon2"><button class="btn btn-outline-secondary" type="button" id="button-addon2"><i class="bi bi-search"></i></button></div></div>',1),Te={__name:"InvoicesView",setup(c){return(b,m)=>(a(),l("main",null,[e("div",xe,[e("div",$e,[Ne,P(U(E),{class:"btn btn-outline-secondary",to:"/invoices/create"},{default:A(()=>[Se,q(" Add Sales Order ")]),_:1})]),Ce,P(we)])]))}};export{Te as default};
